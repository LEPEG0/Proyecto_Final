{"ast":null,"code":"import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup, deleteUser } from '@angular/fire/auth';\nimport { onAuthStateChanged } from '@angular/fire/auth';\nimport { collectionData } from '@angular/fire/firestore';\nimport { collection, addDoc, doc, deleteDoc } from '@angular/fire/firestore';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/auth\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/fire/firestore\";\nexport class UserService {\n  constructor(auth, router, firestore) {\n    this.auth = auth;\n    this.router = router;\n    this.firestore = firestore;\n  }\n  //Metodos para usar en componentes\n  iniciarSesion(email, password, google) {\n    if (google) {} else {\n      this.ingresoAuth({\n        email,\n        password\n      }).then(response => {\n        console.log(response);\n        this.consultaUsuarioFs().subscribe(users => {\n          this.usuarios = users;\n        });\n        for (let i of this.usuarios) {\n          if (email == i.correo) {\n            this.usuario = i;\n          }\n        }\n        localStorage.removeItem(\"usuarioActual\");\n        localStorage.setItem(\"usuarioActual\", JSON.stringify(this.usuario));\n      }).catch(error => console.log(error));\n    }\n  }\n  registrarUsuario(usuario, google) {\n    return new Promise(resolve => {\n      setTimeout(() => {\n        //aqui\n        if (google) {} else {\n          let email = usuario.correo;\n          let password = usuario.contrasena;\n          this.registroAuth({\n            email,\n            password\n          }).then(response => {\n            if (response != null) {\n              console.log(\"lograo papi\");\n              this.form = new FormGroup({\n                nombre: new FormControl(usuario.nombre),\n                apellido: new FormControl(usuario.apellido),\n                correo: new FormControl(usuario.correo),\n                telefono: new FormControl(usuario.telefono),\n                contrasena: new FormControl(usuario.contrasena),\n                nacimiento: new FormControl(usuario.nacimiento)\n              });\n              this.usuario = usuario;\n              console.log(response);\n              const resp = this.nuevoUsuarioFs(this.form.value);\n              console.log(resp);\n              localStorage.removeItem(\"usuarioActual\");\n              localStorage.setItem(\"usuarioActual\", JSON.stringify(this.usuario));\n            }\n          }).catch(error => {\n            console.log(error);\n            if (error != null) {\n              console.log(\"hay error\");\n            }\n          });\n        }\n        //fin\n        resolve;\n      }, 2000); // Simulando un proceso que toma 3 segundos\n    });\n  }\n\n  cerrarSesion() {\n    this.cerrarAuth();\n    localStorage.removeItem(\"usuarioActual\");\n  }\n  borrarUsuario(usuario) {\n    let email = usuario.correo;\n    this.borrarAuth({\n      email\n    }).then(response => {\n      console.log(response);\n      this.borrarUsuarioFs(usuario);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n  //Metodos de Firebase Authentication\n  mostrarAuth() {\n    return String(this.auth.currentUser?.email);\n  }\n  registroAuth({\n    email,\n    password\n  }) {\n    return createUserWithEmailAndPassword(this.auth, email, password);\n  }\n  ingresoAuth({\n    email,\n    password\n  }) {\n    return signInWithEmailAndPassword(this.auth, email, password);\n  }\n  cerrarAuth() {\n    return signOut(this.auth);\n  }\n  borrarAuth({\n    email\n  }) {\n    return deleteUser(email);\n  }\n  sesionAuth(user) {\n    onAuthStateChanged(this.auth, user => {\n      if (user) {\n        this.router.navigate(['/logout']);\n      } else {}\n    });\n  }\n  ingresoGoogleAuth() {\n    return signInWithPopup(this.auth, new GoogleAuthProvider());\n  }\n  //Metodos de Firestore\n  nuevoUsuarioFs(usuario) {\n    const usarioRef = collection(this.firestore, 'usuarios');\n    return addDoc(usarioRef, usuario);\n  }\n  consultaUsuarioFs() {\n    const usuarioRef = collection(this.firestore, 'usuarios');\n    return collectionData(usuarioRef, {\n      idField: 'id'\n    });\n  }\n  borrarUsuarioFs(usuario) {\n    const usuarioRef = doc(this.firestore, `usuarios/${usuario.id}`);\n    return deleteDoc(usuarioRef);\n  }\n  validarUsuario(correo) {\n    this.consultaUsuarioFs().subscribe(users => {\n      this.usuarios = users;\n    });\n    if (this.usuarios != null) {\n      for (let i of this.usuarios) {\n        if (i.correo == correo) {\n          return false;\n        }\n      }\n      return true;\n    } else {\n      return true;\n    }\n  }\n}\nUserService.ɵfac = function UserService_Factory(t) {\n  return new (t || UserService)(i0.ɵɵinject(i1.Auth), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.Firestore));\n};\nUserService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserService,\n  factory: UserService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","GoogleAuthProvider","signInWithPopup","deleteUser","onAuthStateChanged","collectionData","collection","addDoc","doc","deleteDoc","FormControl","FormGroup","UserService","constructor","auth","router","firestore","iniciarSesion","email","password","google","ingresoAuth","then","response","console","log","consultaUsuarioFs","subscribe","users","usuarios","i","correo","usuario","localStorage","removeItem","setItem","JSON","stringify","catch","error","registrarUsuario","Promise","resolve","setTimeout","contrasena","registroAuth","form","nombre","apellido","telefono","nacimiento","resp","nuevoUsuarioFs","value","cerrarSesion","cerrarAuth","borrarUsuario","borrarAuth","borrarUsuarioFs","mostrarAuth","String","currentUser","sesionAuth","user","navigate","ingresoGoogleAuth","usarioRef","usuarioRef","idField","id","validarUsuario","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\Artur\\Desktop\\ProyectoFinal1\\src\\app\\services\\user.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {\n  Auth,\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  signOut,\n  GoogleAuthProvider,\n  signInWithPopup,\n  deleteUser\n} from '@angular/fire/auth';\nimport { onAuthStateChanged } from '@angular/fire/auth';\nimport { Firestore, collectionData } from '@angular/fire/firestore';\nimport { collection, addDoc, doc, deleteDoc } from '@angular/fire/firestore';\nimport { Observable } from 'rxjs';\nimport { Router } from '@angular/router';\nimport User from './user.interface';\nimport { FormControl, FormGroup } from '@angular/forms';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class UserService {\n  usuario!: User;\n  usuarios!: User[];\n  form!: FormGroup;\n\n  constructor(\n    private auth: Auth,\n    private router: Router,\n    private firestore: Firestore\n  ) { }\n\n  //Metodos para usar en componentes\n  iniciarSesion(email: string, password: string, google: Boolean) {\n    if (google) {\n\n    } else {\n      this.ingresoAuth({ email, password })\n        .then(response => {\n          console.log(response);\n          this.consultaUsuarioFs().subscribe(users => {\n            this.usuarios = users;\n          });\n          for (let i of this.usuarios) {\n            if (email == i.correo) {\n              this.usuario = i;\n            }\n          }\n          localStorage.removeItem(\"usuarioActual\");\n          localStorage.setItem(\"usuarioActual\", JSON.stringify(this.usuario));\n        })\n        .catch(error => console.log(error));\n    }\n  }\n\n  registrarUsuario(usuario: User, google: Boolean) {\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        //aqui\n        if (google) {\n\n        } else {\n          let email = usuario.correo;\n          let password = usuario.contrasena;\n          this.registroAuth({ email, password })\n            .then(response => {\n              if (response != null) {\n                console.log(\"lograo papi\");\n                this.form = new FormGroup({\n                  nombre: new FormControl(usuario.nombre),\n                  apellido: new FormControl(usuario.apellido),\n                  correo: new FormControl(usuario.correo),\n                  telefono: new FormControl(usuario.telefono),\n                  contrasena: new FormControl(usuario.contrasena),\n                  nacimiento: new FormControl(usuario.nacimiento)\n                })\n                this.usuario = usuario;\n                console.log(response);\n                const resp = this.nuevoUsuarioFs(this.form.value);\n                console.log(resp);\n                localStorage.removeItem(\"usuarioActual\");\n                localStorage.setItem(\"usuarioActual\", JSON.stringify(this.usuario));\n              }\n            })\n            .catch(error => {\n              console.log(error)\n              if (error != null) {\n                console.log(\"hay error\")\n              }\n            });\n        }\n        //fin\n        resolve\n      }, 2000); // Simulando un proceso que toma 3 segundos\n    });\n\n  }\n\n  cerrarSesion() {\n    this.cerrarAuth();\n    localStorage.removeItem(\"usuarioActual\");\n  }\n\n  borrarUsuario(usuario: User) {\n    let email = usuario.correo;\n    this.borrarAuth({ email })\n      .then(response => {\n        console.log(response);\n        this.borrarUsuarioFs(usuario);\n      })\n      .catch(error => {\n        console.log(error);\n      })\n  }\n\n  //Metodos de Firebase Authentication\n  mostrarAuth(): string {\n    return String(this.auth.currentUser?.email);\n  }\n\n  registroAuth({ email, password }: any) {\n    return createUserWithEmailAndPassword(this.auth, email, password);\n  }\n\n  ingresoAuth({ email, password }: any) {\n    return signInWithEmailAndPassword(this.auth, email, password);\n  }\n\n  cerrarAuth() {\n    return signOut(this.auth);\n  }\n\n  borrarAuth({ email }: any) {\n    return deleteUser(email);\n  }\n\n  sesionAuth(user: UserService) {\n    onAuthStateChanged(this.auth, (user) => {\n      if (user) {\n        this.router.navigate(['/logout']);\n      } else {\n\n      }\n    })\n  }\n\n  ingresoGoogleAuth() {\n    return signInWithPopup(this.auth, new GoogleAuthProvider());\n  }\n\n  //Metodos de Firestore\n  nuevoUsuarioFs(usuario: User) {\n    const usarioRef = collection(this.firestore, 'usuarios');\n    return addDoc(usarioRef, usuario);\n  }\n\n  consultaUsuarioFs(): Observable<User[]> {\n    const usuarioRef = collection(this.firestore, 'usuarios');\n    return collectionData(usuarioRef, { idField: 'id' }) as Observable<User[]>;\n  }\n\n  borrarUsuarioFs(usuario: User) {\n    const usuarioRef = doc(this.firestore, `usuarios/${usuario.id}`);\n    return deleteDoc(usuarioRef);\n\n  }\n\n  validarUsuario(correo: string): Boolean {\n    this.consultaUsuarioFs().subscribe(users => {\n      this.usuarios = users;\n    })\n    if (this.usuarios != null) {\n      for (let i of this.usuarios) {\n        if (i.correo == correo) {\n          return false;\n        }\n      }\n      return true;\n    } else {\n      return true\n    }\n  }\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}